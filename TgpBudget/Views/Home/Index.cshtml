@{
    ViewBag.Title = "Dashboard";
}

<div class="row">

    <div class="col-md-4">
        <div class="card">
            <div class="header">
                <h4 class="title">Categories</h4>

            </div>
            <div class="content">
                <div id="categoryPieChart" class="ct-chart ct-perfect-fourth"></div>

                <div class="footer">
                    <div class="legend">
                        <i class="fa fa-circle text-info"></i> Open
                        <i class="fa fa-circle text-danger"></i> Bounce
                        <i class="fa fa-circle text-warning"></i> Unsubscribe
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card">
            <div class="header">
                <h4 class="title">Bank Account Balance</h4>
                <p class="category">Top accounts over pas year</p>
            </div>
            <div class="content">
                <div id="chartBankAccts" class="ct-chart"></div>
                @*@Html.Action("_BankStmtChart", "BankAccts")*@
                <div class="footer">
                    <div class="legend">
                        <i class="fa fa-circle text-info"></i> Open
                        <i class="fa fa-circle text-danger"></i> Click
                        <i class="fa fa-circle text-warning"></i> Click Second Time
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card ">
            <div class="header">
                <div class="row">
                    <div class="col-sm-4" style="display:inline">
                        <h4>Income/Expense</h4>
                    </div>

                    <div class="col-sm-8" style="display:inline; margin:30px 0 0px">
                        <div class="btn-group" data-toggle="buttons">
                            <label class="radio-inline btn btn-primary ">
                                <input type="radio" id="fourMonthsBtn" name="period" value="currentMonth" />4 mo's
                            </label>
                            <label class="radio-inline btn btn-primary ">
                                <input type="radio" id="fourQuartersBtn" name="period" value="priorMonth" />4 Qtrs
                            </label>
                            <label class="radio-inline btn btn-primary ">
                                <input type="radio" id="twelveMonthsBtn" name="period" value="last30Days" />12 mo's
                            </label>

                        </div>
                    </div>
                </div>
            </div>
            <div class="content">
                <div id="incExpBarChart" class="ct-chart"></div>

                <div class="footer">
                    <div class="legend">INCOME
                        <i class="text-info fa fa-circle"></i>Budget
                        <i class="text-danger fa fa-circle"></i>Actual : EXPENSE
                        <i class="text-warning fa fa-circle"></i>Budget
                        <i class="fa fa-circle" style="color:#9368E9"></i>Actual :
                        <i class="text-success fa fa-circle"></i>NET $
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div id="divPartialBankAccts">
                @Html.Action("_Index", "BankAccts")
            </div>
        </div>
    </div>

</div>
<div class="row">

    <div class="col-sm-7">
        <div class="card">
            <div id="divPartialDeals">
                @Html.Action("_Index", "Deals")
            </div>
        </div>
    </div>
    <div class="col-md-5">
        <div class="card">
            <div class="row">
                <div class="col-sm-2" style="display:inline">
                    <h4>Budget</h4>
                </div>

                <div class="col-sm-10" style="display:inline; margin:30px 0 0px">

                    <div class="btn-group" data-toggle="buttons">

                        <label class="radio-inline btn btn-primary ">
                            <input type="radio" id="currentMonthBtn" name="period" value="currentMonthPartial" />Cur Mon
                        </label>
                        <label class="radio-inline btn btn-primary ">
                            <input type="radio" id="priorMonthBtn" name="period" value="priorMonthPartial" />Prior
                        </label>

                        <label class="radio-inline btn btn-primary ">
                            <input type="radio" id="last30DaysBtn" name="period" value="last30DaysPartial" />30 Days
                        </label>

                        <label class="radio-inline btn btn-primary ">
                            <input type="radio" id="avg90DaysBtn" name="period" value="avg90DaysPartial" />90d Avg
                        </label>

                    </div>
                </div>
            </div>
            <div id="divPartialCategories">
                @Html.Action("Index", "Categories", new { period = "currentMonthPartial" })
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>


        $(document).ready(function () {

            demo.initChartist();

            $.post('@Url.Action("GetBankChartData","BankAccts")').then(function (response) {
                console.log('response: ' + response);

                var optionsBankChart = {
                    lineSmooth: false,
                    low: -10000,
                    high: 30000,
                    showArea: true,
                    height: "245px",
                    axisX: {
                        showGrid: false,
                    },
                    lineSmooth: Chartist.Interpolation.simple({
                        divisor: 3
                    }),
                    showLine: true,
                    showPoint: false,
                };

                var responsiveBankChart = [
                  ['screen and (max-width: 640px)', {
                      axisX: {
                          labelInterpolationFnc: function (value) {
                              return value[0];
                          }
                      }
                  }]
                ];


                new Chartist.Line('#chartBankAccts', response, optionsBankChart, responsiveBankChart);
            })

            $.notify({
                icon: 'pe-7s-gift',
                message: "Welcome to <b>TGP Budget</b> - a budgetting App for households."

            }, {
                type: 'info',
                timer: 1000
            });

        });




        $.post('@Url.Action("GetCategoryPieChart", "Categories")').then(function (response) {

            console.log(' Inside GetCategoryPieChart response: ' + response);


            var optionsPreferences = {
                donut: true,
                donutWidth: 40,
                startAngle: 0,
                total: 100,
                chartPadding: 30,
                labelOffset: 25,
                labelDirection: 'explode',
                ignoreEmptyValues: true,
                showLabel: true,
                axisX: {
                    showGrid: false
                }
            };

            var options = {
                labelInterpolationFnc: function (value) {
                    return value[0]
                }
            };

            var responsiveOptions = [
              ['screen and (min-width: 640px)', {
                  chartPadding: 30,
                  labelOffset: 10,
                  labelDirection: 'explode',
                  labelInterpolationFnc: function (value) {
                      return value;
                  }
              }],
              ['screen and (min-width: 1024px)', {
                  labelOffset: 80,
                  chartPadding: 20
              }]
            ];

            new Chartist.Pie('#categoryPieChart', response, options, responsiveOptions);


        });






        $.post('@Url.Action("GetIncExpBarChart", "Categories")').then(function (response) {

            console.log(' Inside GetIncExpBarChart response: ' + response);


            Chartist.Bar('#incExpBarChart', response,
                {
                // Default mobile configuration
                stackBars: true,
                axisX: {
                    labelInterpolationFnc: function (value) {
                        return value.split(/\s+/).map(function (word) {
                            return word[0];
                        }).join('');
                    }
                },
                axisY: {
                    offset: 20
                }
            }, [
    // Options override for media > 400px
    ['screen and (min-width: 400px)', {
        reverseData: true,
        horizontalBars: true,
        axisX: {
            labelInterpolationFnc: Chartist.noop
        },
        axisY: {
            offset: 60
        }
    }],
    // Options override for media > 800px
    ['screen and (min-width: 800px)', {
        stackBars: false,
        seriesBarDistance: 10
    }],
    // Options override for media > 1000px
    ['screen and (min-width: 1000px)', {
        reverseData: false,
        horizontalBars: false,
        seriesBarDistance: 15
    }]
            ]);



        });







        //$(document).ready(function () {
        // $('.table').DataTable();
        //});
        var categoryId = 0;
        $('#delCategoryModal').on('shown.bs.modal', function (e) {
            var j = $(e.relatedTarget).data('id');
            console.log(' categoryId j: ' + j);
            categoryId = j;
            $('.modal-backdrop').removeClass('modal-backdrop');
            $('#modal-id').val(categoryId);
        });

        $('body').on('change', '#currentMonthBtn', function (e) {

            //$("[name=period]").removeAttr("checked");
            //$('#currentMonthBtn').prop("checked", true);
            $('#divPartialCategories').load('/Categories/Index?period=currentMonthPartial');
        });
        $('body').on('change', '#priorMonthBtn', function (e) {

            //$("[name=period]").removeAttr("checked");
            //$('#priorMonthBtn').prop("checked", true);

            $('#divPartialCategories').load('/Categories/Index?period=priorMonthPartial');
        });

        $('body').on('change', '#last30DaysBtn', function (e) {

            $('#divPartialCategories').load('/Categories/Index?period=last30DaysPartial');
        });
        $('body').on('change', '#avg90DaysBtn', function (e) {
            //$("[name=period]").removeAttr("checked");
            //$('#avg90DaysBtn').prop("checked", true);
            $('#divPartialCategories').load('/Categories/Index?period=avg90DaysPartial');
        });


        //var presetValue = "currentMonth";
        //$("[name=period]").filter("[value='" + presetValue + "']").prop("checked", true);

    </script>
}
